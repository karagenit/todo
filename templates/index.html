<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Google Tasks Organizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</head>
<body class="p-4">
    <form action="/reload" method="GET">
        <button type="submit" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded text-sm">Reload Tasks</button>
    </form>

    <form action="/" method="GET" class="mt-4"> <!-- could do onsubmit form.search.removeAttribute('name') to clear it from url params -->
        <input type="text" name="search" value="{{ filter_args.search }}" placeholder="Search tasks..." class="border border-gray-400 rounded px-2 py-1 text-sm">
        <button type="submit" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded text-sm ml-2">Search</button>
        <button type="submit" onclick="this.form.search.value=''" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded text-sm ml-2">Clear</button>
        <input type="checkbox" name="show_future" {% if filter_args.show_future %}checked{% endif %} class="hidden">
        <button type="submit" onclick="this.form.show_future.checked = !this.form.show_future.checked;"
            class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded text-sm ml-2">
            {% if filter_args.show_future %}Hide Future Tasks{% else %}Show Future Tasks{% endif %}
        </button>
    </form>        
    <table class="mt-4">
        <tr class="bg-gray-200">
            <th class="border border-gray-500 p-1">P3</th>
            <th class="border border-gray-500 p-1">P2</th>
            <th class="border border-gray-500 p-1">P1</th>
            <th class="border border-gray-500 p-1">P0</th>
            <th class="border border-gray-500 p-1">Overdue</th>
            <th class="border border-gray-500 p-1">Due Today</th>
            <th class="border border-gray-500 p-1">Due This Week</th>
            <th class="border border-gray-500 p-1">Due This Month</th>
        </tr>
        <tr>
            <td class="border border-gray-500 p-1">{{ stats.p3 }}</td>
            <td class="border border-gray-500 p-1">{{ stats.p2 }}</td>
            <td class="border border-gray-500 p-1">{{ stats.p1 }}</td>
            <td class="border border-gray-500 p-1">{{ stats.p0 }}</td>
            <td class="border border-gray-500 p-1">{{ stats.overdue }}</td>
            <td class="border border-gray-500 p-1">{{ stats.today }}</td>
            <td class="border border-gray-500 p-1">{{ stats.week }}</td>
            <td class="border border-gray-500 p-1">{{ stats.month }}</td>
        </tr>
    </table>     
    
    {% for task in tasks %}
    <div class="border border-gray-500 rounded flex flex-col max-w-[48em] p-2 mt-4">
        <form action="/update" method="POST" class="flex flex-col">
            <input type="hidden" name="task_id" value="{{ task.id }}">
            <div class="flex flex-row mb-2">
                <input type="text" name="title" value="{{ task.title }}" placeholder="Task Title" class="flex-grow mr-2 border-b border-gray-400 focus:outline-none pl-1 font-medium">
                <input type="number" name="priority" value="{{ task.priority }}" max="3" min="0" placeholder="P#" class="w-9 border rounded border-gray-400 pl-1 focus:outline-none">
                {% if task.id %}
                <button type="submit" name="action_complete" value="true" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-1.5 rounded ml-2">✓</button>
                {% endif %}
            </div>        
            <div class="flex flex-row flex-wrap mb-2 gap-x-6 gap-y-2">
                <div class="flex flex-row items-center min-w-[200px] flex-1">
                    <span class="mr-1.5 text-sm text-gray-700">Start</span>
                    <input class="border rounded border-gray-400 px-1 mr-2 h-7 text-sm flex-grow" type="date" name="start_date" value="{{ task.start_date_str() }}">
                    <button type="submit" name="action_tomorrow" value="true" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-1.5 rounded h-7">→</button>
                </div>
                <div class="flex flex-row items-center min-w-[200px] flex-1">
                    <span class="mr-1.5 text-sm text-gray-700">Due</span>
                    <input class="border rounded border-gray-400 px-1 h-7 text-sm flex-grow" type="date" name="due_date" value="{{ task.due_date_str() }}">
                    <button type="button" onclick="this.parentElement.querySelector('input[name=due_date]').valueAsDate = new Date(new Date().toLocaleDateString())" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-1.5 rounded ml-2 h-7 w-7">!</button>
                </div>
                <div class="flex flex-row items-center min-w-[200px] flex-1">
                    <span class="mr-1.5 text-sm text-gray-700">Assigned</span>
                    <input class="border rounded border-gray-400 px-1 h-7 text-sm flex-grow" type="date" name="assigned_date" value="{{ task.assigned_date_str() }}">
                </div>
                <div class="flex flex-row items-center min-w-[74px] flex-1">
                    <button type="button" onclick="document.getElementById('repeat-row-{{ task.id }}').classList.toggle('hidden')" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-1.5 rounded h-7 text-sm">+ Repeat</button>
                </div>            
            </div>
            <div class="{% if not task.repeat %}hidden{% endif %} flex flex-row flex-wrap mb-2 gap-x-6 gap-y-2" id="repeat-row-{{ task.id }}">
                <div id="repeat-field" class="flex flex-row items-center flex-1">
                    <span class="mr-1.5 text-sm text-gray-700">Repeat</span>
                    <input class="border rounded border-gray-400 px-1 h-7 text-sm pl-2 flex-grow" type="text" name="repeat" value="{{ task.repeat }}"
                        placeholder="DoM[1-31] MoY[1-12] DoW[0-6] DaysInterval[0-999] FromStartOrComplete[SC]">
                </div>
            </div>
            <textarea name="description" class="bg-gray-100 rounded p-1 text-sm text-gray-700">{{ task.description }}</textarea>
            <div class="form-row hidden mt-2" id="action-bar">
                <button type="submit" class="border border-green-500 hover:bg-green-100 px-2 py-1 mr-1 rounded text-sm text-green-700">Save</button>
                <button type="button" onclick="window.location.reload()" class="border border-red-500 hover:bg-red-200 px-2 py-1 rounded text-sm text-red-700">Discard</button>
            </div>
        </form>
        {% for child in task.children %}
        <div class="mt-3">
            <form action="/update" method="POST" class="flex flex-col">
                <input type="hidden" name="task_id" value="{{ child.id }}">
                <input type="hidden" name="parent_id" value="{{ task.id }}">
                <div class="flex flex-row">
                    {% if child.id %}
                    <button type="submit" name="action_complete" value="true" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-1.5 rounded mr-2 w-6 text-sm">✓</button>
                    {% else %}
                    <button type="submit" class="border border-gray-500 bg-gray-100 hover:bg-gray-200 px-1.5 rounded mr-2 w-6 text-sm">+</button>
                    {% endif %}
                    <input type="text" name="title" value="{{ child.title }}" placeholder="Subtask Title" class="flex-grow mr-2 border-b border-gray-400 focus:outline-none pl-1 text-sm max-w-[60%]">                        
                </div> 
            </form>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</body>
</html>
